<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAC Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top for better scrolling */
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .chatbot-container {
            width: 100%;
            max-width: 400px;
            background-color: #ffffff;
            border-radius: 1rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-xl */
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 500px; /* Minimum height for better appearance */
            max-height: 80vh; /* Max height for scrollability */
        }
        .chat-header {
            background-color: #002147; /* Deep Navy Blue from logo concept */
            color: #ffffff;
            padding: 1rem;
            font-weight: 600; /* semibold */
            text-align: center;
            border-top-left-radius: 1rem;
            border-top-right-radius: 1rem;
        }
        .chat-messages {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            background-color: #f9fafb; /* Light gray for chat background */
        }
        .message {
            margin-bottom: 0.75rem; /* mb-3 */
            max-width: 80%;
            border-radius: 0.75rem; /* rounded-lg */
            padding: 0.6rem 0.9rem; /* px-3 py-2.5 */
            word-wrap: break-word;
        }
        .message.bot {
            background-color: #e0f2fe; /* Light blue */
            color: #002147;
            align-self: flex-start;
            margin-right: auto;
        }
        .message.user {
            background-color: #002147; /* Deep Navy Blue */
            color: #ffffff;
            align-self: flex-end;
            margin-left: auto;
        }
        .input-area {
            padding: 1rem;
            border-top: 1px solid #e5e7eb; /* border-t border-gray-200 */
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .quick-reply-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
        }
        .quick-reply-button {
            background-color: #e5e7eb; /* gray-200 */
            color: #374151; /* gray-700 */
            padding: 0.5rem 1rem;
            border-radius: 0.5rem; /* rounded-lg */
            cursor: pointer;
            font-size: 0.875rem; /* text-sm */
            transition: background-color 0.2s ease;
            white-space: nowrap; /* Prevent wrapping */
        }
        .quick-reply-button:hover {
            background-color: #d1d5db; /* gray-300 */
        }
        .quick-reply-button.selected {
            background-color: #002147;
            color: #ffffff;
        }
        textarea {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.75rem; /* rounded-xl */
            border: 1px solid #d1d5db; /* border-gray-300 */
            resize: none;
            font-size: 1rem;
            min-height: 40px;
        }
        button {
            background-color: #B8860B; /* Muted Gold/Bronze */
            color: #ffffff;
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem; /* rounded-xl */
            font-weight: 600; /* semibold */
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        button:hover {
            background-color: #a0740a; /* Darker gold */
        }
        .contact-form {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            padding: 1rem;
            background-color: #f9fafb;
            border-top: 1px solid #e5e7eb;
        }
        .contact-form input, .contact-form textarea {
            padding: 0.75rem;
            border-radius: 0.75rem;
            border: 1px solid #d1d5db;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="chatbot-container">
        <div class="chat-header">
            MAC's AI Assistant
        </div>
        <div class="chat-messages" id="chat-messages">
            <!-- Messages will be appended here -->
        </div>
        <div class="input-area" id="input-area">
            <div class="quick-reply-buttons" id="quick-reply-buttons">
                <!-- Quick reply buttons will be appended here -->
            </div>
            <textarea id="user-input" placeholder="Type your message..." rows="1" class="hidden"></textarea>
            <button id="send-button" class="hidden">Send</button>
        </div>

        <!-- Contact Form (initially hidden) -->
        <div class="contact-form hidden" id="contact-form">
            <h3 class="text-lg font-semibold text-center text-gray-800">Request a Consultation</h3>
            <p class="text-sm text-gray-600 text-center">Please provide your details, and MAC's team will get in touch.</p>
            <input type="text" id="contact-name" placeholder="Your Name" class="p-3 rounded-lg border border-gray-300">
            <input type="email" id="contact-email" placeholder="Your Email" class="p-3 rounded-lg border border-gray-300">
            <input type="tel" id="contact-phone" placeholder="Your Phone (Optional)" class="p-3 rounded-lg border border-gray-300">
            <textarea id="contact-message" placeholder="Briefly describe your needs..." rows="3" class="p-3 rounded-lg border border-gray-300"></textarea>
            <button id="submit-contact">Submit Request</button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const quickReplyButtonsContainer = document.getElementById('quick-reply-buttons');
        const inputArea = document.getElementById('input-area');
        const contactForm = document.getElementById('contact-form');
        const submitContactButton = document.getElementById('submit-contact');

        let conversationState = 'start';
        let qualificationAnswers = {};

        const faqs = {
            "What is SAM.gov?": "SAM.gov (System for Award Management) is the primary government system for entities to register to do business with the U.S. government, find contract opportunities, and more.",
            "What is the FAR?": "The Federal Acquisition Regulation (FAR) is the primary regulation for use by all executive agencies in their acquisition of supplies and services with appropriated funds. It's the rulebook for government contracting.",
            "What types of contracts does MAC specialize in?": "MAC specializes in navigating complex government contract types, particularly Firm-Fixed Price (F-F-P), Cost-Reimbursement, Time & Materials (T&M), and Labor Hour (LH) contracts, ensuring you understand the risks and requirements.",
            "How can MAC help with proposal writing?": "MAC provides insider insights on technical proposal writing, helping you avoid common pitfalls like generic submissions and ensuring your proposal directly addresses agency needs.",
            "How can MAC help with pricing?": "MAC offers expert guidance on precise cost proposal documentation, understanding contract types, and avoiding common pricing errors that lead to disqualification or reduced profits.",
            "What about compliance?": "MAC helps you navigate the 'small print' of compliance matrices, Section L, and Section M, ensuring your submissions are fully compliant and avoid outright rejection. We also advise on managing scope in personal services contracts."
        };

        const qualificationQuestions = [
            {
                id: 'goal',
                question: "To help me understand if a consultation with MAC is the right fit, could you tell me your primary goal with government contracting?",
                options: ["Win my first contract", "Improve proposal success", "Ensure compliance", "Manage current contracts", "Other (type below)"]
            },
            {
                id: 'revenue',
                question: "What is the approximate annual revenue of your business?",
                options: ["Under $1M", "$1M - $5M", "$5M - $25M", "Over $25M"]
            },
            {
                id: 'active',
                question: "Are you currently bidding on or actively managing government contracts?",
                options: ["Yes, actively bidding/managing", "No, just exploring/starting out"]
            },
            {
                id: 'area',
                question: "What specific area of government contracting are you seeking assistance with?",
                options: ["Proposal Writing (Technical)", "Cost/Price Proposals", "Contract Compliance", "Negotiation/Strategy", "Post-Award Management", "Other (type below)"]
            }
        ];
        let currentQuestionIndex = 0;

        function addMessage(text, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', sender);
            messageElement.textContent = text;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Auto-scroll to bottom
        }

        function showQuickReplies(options) {
            quickReplyButtonsContainer.innerHTML = '';
            userInput.classList.add('hidden');
            sendButton.classList.add('hidden');

            options.forEach(option => {
                const button = document.createElement('button');
                button.classList.add('quick-reply-button');
                button.textContent = option;
                button.onclick = () => handleUserInput(option, true);
                quickReplyButtonsContainer.appendChild(button);
            });
            quickReplyButtonsContainer.classList.remove('hidden');
        }

        function hideQuickReplies() {
            quickReplyButtonsContainer.innerHTML = '';
            quickReplyButtonsContainer.classList.add('hidden');
            userInput.classList.remove('hidden');
            sendButton.classList.remove('hidden');
        }

        function handleUserInput(message, isQuickReply = false) {
            if (!isQuickReply && userInput.value.trim() === '') return;

            const userText = isQuickReply ? message : userInput.value.trim();
            addMessage(userText, 'user');
            userInput.value = ''; // Clear input field

            switch (conversationState) {
                case 'start':
                    if (userText.toLowerCase().includes("question") || userText.toLowerCase().includes("faq")) {
                        conversationState = 'faq_menu';
                        const faqOptions = Object.keys(faqs);
                        addMessage("Great! Here are some common questions I can answer:", 'bot');
                        showQuickReplies(faqOptions.concat(["Something else (type below)", "Back to main menu"]));
                        userInput.classList.remove('hidden'); // Show input for "Something else"
                        sendButton.classList.remove('hidden');
                    } else if (userText.toLowerCase().includes("consultation") || userText.toLowerCase().includes("talk to mac")) {
                        conversationState = 'qualify';
                        currentQuestionIndex = 0;
                        addMessage(qualificationQuestions[currentQuestionIndex].question, 'bot');
                        showQuickReplies(qualificationQuestions[currentQuestionIndex].options);
                    } else if (userText.toLowerCase().includes("ebook") || userText.toLowerCase().includes("webinar") || userText.toLowerCase().includes("free guide")) {
                        conversationState = 'start'; // Remain in start state after providing info
                        addMessage("The free ebook 'Avoid the Top 3 Costly Government Contracting Mistakes' comes with a FREE seat to our exclusive webinar 'Mastering Government Submissions: Insider Secrets to Avoid Disqualification & Win More Contracts' (a $1500 value!). Simply fill out the form on the landing page to get both.", 'bot');
                        showQuickReplies(["I have a question about government contracting.", "I'm interested in a consultation with MAC."]);
                    } else {
                        addMessage("I'm sorry, I didn't quite understand that. Please choose one of the options below or type 'question' or 'consultation'.", 'bot');
                        showQuickReplies(["I have a question about government contracting.", "I'm interested in a consultation with MAC.", "Tell me more about the free ebook/webinar."]);
                    }
                    break;

                case 'faq_menu':
                    if (faqs[userText]) {
                        addMessage(faqs[userText], 'bot');
                        addMessage("Is there anything else I can help you with?", 'bot');
                        showQuickReplies(Object.keys(faqs).concat(["Something else (type below)", "Back to main menu"]));
                        userInput.classList.remove('hidden');
                        sendButton.classList.remove('hidden');
                    } else if (userText.toLowerCase().includes("something else")) {
                        hideQuickReplies();
                        addMessage("Please type your question, and I'll do my best to answer.", 'bot');
                        conversationState = 'faq_free_text';
                    } else if (userText.toLowerCase().includes("back to main menu")) {
                        addMessage("No problem! How can I help you now?", 'bot');
                        conversationState = 'start';
                        showQuickReplies(["I have a question about government contracting.", "I'm interested in a consultation with MAC.", "Tell me more about the free ebook/webinar."]);
                    } else {
                        addMessage("I can answer questions about SAM.gov, FAR, contract types, proposal writing, pricing, and compliance. Please choose from the options or type 'something else'.", 'bot');
                        showQuickReplies(Object.keys(faqs).concat(["Something else (type below)", "Back to main menu"]));
                        userInput.classList.remove('hidden');
                        sendButton.classList.remove('hidden');
                    }
                    break;

                case 'faq_free_text':
                    addMessage("Thanks for your question. While I can answer common FAQs, for detailed or specific inquiries, it's best to consult directly with MAC. Would you like to request a consultation?", 'bot');
                    showQuickReplies(["Yes, request consultation", "No, back to main menu"]);
                    conversationState = 'faq_free_text_followup';
                    break;

                case 'faq_free_text_followup':
                    if (userText.toLowerCase().includes("yes")) {
                        conversationState = 'qualify';
                        currentQuestionIndex = 0;
                        addMessage(qualificationQuestions[currentQuestionIndex].question, 'bot');
                        showQuickReplies(qualificationQuestions[currentQuestionIndex].options);
                    } else if (userText.toLowerCase().includes("no")) {
                        addMessage("No problem! How can I help you now?", 'bot');
                        conversationState = 'start';
                        showQuickReplies(["I have a question about government contracting.", "I'm interested in a consultation with MAC.", "Tell me more about the free ebook/webinar."]);
                    } else {
                        addMessage("Please choose 'Yes, request consultation' or 'No, back to main menu'.", 'bot');
                        showQuickReplies(["Yes, request consultation", "No, back to main menu"]);
                    }
                    break;

                case 'qualify':
                    qualificationAnswers[qualificationQuestions[currentQuestionIndex].id] = userText;
                    currentQuestionIndex++;

                    if (currentQuestionIndex < qualificationQuestions.length) {
                        addMessage(qualificationQuestions[currentQuestionIndex].question, 'bot');
                        showQuickReplies(qualificationQuestions[currentQuestionIndex].options);
                    } else {
                        // All qualification questions answered, now evaluate
                        hideQuickReplies();
                        evaluateQualification();
                    }
                    break;
            }
        }

        function evaluateQualification() {
            const revenue = qualificationAnswers.revenue;
            const active = qualificationAnswers.active;

            if (revenue === "Under $1M" && active === "No, just exploring/starting out") {
                addMessage("Based on your answers, our free ebook and webinar are likely the best starting point for you to build foundational knowledge. They are packed with valuable insights from MAC's 30 years of experience. Please fill out the form on the landing page to access them!", 'bot');
                addMessage("Would you like to ask another question or go back to the main menu?", 'bot');
                showQuickReplies(["I have a question about government contracting.", "Back to main menu"]);
                conversationState = 'start'; // Reset state for new interaction
            } else {
                addMessage("Great! Based on your needs, a consultation with MAC would be highly beneficial. MAC provides tailored, insider guidance for businesses like yours.", 'bot');
                addMessage("Please provide your contact details below so we can schedule a call.", 'bot');
                inputArea.classList.add('hidden'); // Hide chat input
                contactForm.classList.remove('hidden'); // Show contact form
                conversationState = 'await_contact_details';
            }
        }

        function submitContactDetails() {
            const name = document.getElementById('contact-name').value;
            const email = document.getElementById('contact-email').value;
            const phone = document.getElementById('contact-phone').value;
            const message = document.getElementById('contact-message').value;

            if (!name || !email) {
                alert('Please provide your name and email.');
                return;
            }

            // In a real application, you would send this data to your server/CRM
            console.log("Consultation Request Submitted:");
            console.log("Name:", name);
            console.log("Email:", email);
            console.log("Phone:", phone);
            console.log("Needs:", message);
            console.log("Qualification Answers:", qualificationAnswers);

            addMessage("Thank you for your request! MAC's team will review your information and get in touch with you shortly.", 'bot');
            contactForm.classList.add('hidden');
            inputArea.classList.remove('hidden'); // Show input area again
            userInput.classList.add('hidden'); // But hide text input
            sendButton.classList.add('hidden'); // And send button
            showQuickReplies(["Start a new conversation"]); // Offer to restart
            conversationState = 'start_new_conversation';
        }

        function startNewConversation() {
            chatMessages.innerHTML = ''; // Clear chat
            addMessage("Hi there! I'm MAC's AI assistant. How can I help you today?", 'bot');
            showQuickReplies(["I have a question about government contracting.", "I'm interested in a consultation with MAC.", "Tell me more about the free ebook/webinar."]);
            conversationState = 'start';
        }

        // Event Listeners
        sendButton.addEventListener('click', () => handleUserInput(userInput.value));
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) { // Prevent new line on Enter
                e.preventDefault();
                handleUserInput(userInput.value);
            }
        });
        submitContactButton.addEventListener('click', submitContactDetails);

        // Initial greeting
        startNewConversation(); // Call this to start the chat

    </script>
</body>
</html>
